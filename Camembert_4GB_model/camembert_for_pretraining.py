import torch
import torch.nn as nn
from model.camembert_model import CamembertModel, roberta_init_weights
from .camembert_config import CamembertConfig

a = ["camembert.embeddings.word_embeddings.weight", "camembert.embeddings.position_embeddings.weight", "camembert.encoder.layer.0.attention.self.query.weight", "camembert.encoder.layer.0.attention.self.query.bias", "camembert.encoder.layer.0.attention.self.key.weight", "camembert.encoder.layer.0.attention.self.key.bias", "camembert.encoder.layer.0.attention.self.value.weight", "camembert.encoder.layer.0.attention.self.value.bias", "camembert.encoder.layer.0.attention.output.dense.weight", "camembert.encoder.layer.0.attention.output.dense.bias", "camembert.encoder.layer.0.attention.output.LayerNorm.weight", "camembert.encoder.layer.0.attention.output.LayerNorm.bias", "camembert.encoder.layer.0.intermediate.dense.weight", "camembert.encoder.layer.0.intermediate.dense.bias", "camembert.encoder.layer.0.output.dense.weight", "camembert.encoder.layer.0.output.dense.bias", "camembert.encoder.layer.0.output.LayerNorm.weight", "camembert.encoder.layer.0.output.LayerNorm.bias", "camembert.encoder.layer.1.attention.self.query.weight", "camembert.encoder.layer.1.attention.self.query.bias", "camembert.encoder.layer.1.attention.self.key.weight", "camembert.encoder.layer.1.attention.self.key.bias", "camembert.encoder.layer.1.attention.self.value.weight", "camembert.encoder.layer.1.attention.self.value.bias", "camembert.encoder.layer.1.attention.output.dense.weight", "camembert.encoder.layer.1.attention.output.dense.bias", "camembert.encoder.layer.1.attention.output.LayerNorm.weight", "camembert.encoder.layer.1.attention.output.LayerNorm.bias", "camembert.encoder.layer.1.intermediate.dense.weight", "camembert.encoder.layer.1.intermediate.dense.bias", "camembert.encoder.layer.1.output.dense.weight", "camembert.encoder.layer.1.output.dense.bias", "camembert.encoder.layer.1.output.LayerNorm.weight", "camembert.encoder.layer.1.output.LayerNorm.bias", "camembert.encoder.layer.2.attention.self.query.weight", "camembert.encoder.layer.2.attention.self.query.bias", "camembert.encoder.layer.2.attention.self.key.weight", "camembert.encoder.layer.2.attention.self.key.bias", "camembert.encoder.layer.2.attention.self.value.weight", "camembert.encoder.layer.2.attention.self.value.bias", "camembert.encoder.layer.2.attention.output.dense.weight", "camembert.encoder.layer.2.attention.output.dense.bias", "camembert.encoder.layer.2.attention.output.LayerNorm.weight", "camembert.encoder.layer.2.attention.output.LayerNorm.bias", "camembert.encoder.layer.2.intermediate.dense.weight", "camembert.encoder.layer.2.intermediate.dense.bias", "camembert.encoder.layer.2.output.dense.weight", "camembert.encoder.layer.2.output.dense.bias", "camembert.encoder.layer.2.output.LayerNorm.weight", "camembert.encoder.layer.2.output.LayerNorm.bias", "camembert.encoder.layer.3.attention.self.query.weight", "camembert.encoder.layer.3.attention.self.query.bias", "camembert.encoder.layer.3.attention.self.key.weight", "camembert.encoder.layer.3.attention.self.key.bias", "camembert.encoder.layer.3.attention.self.value.weight", "camembert.encoder.layer.3.attention.self.value.bias", "camembert.encoder.layer.3.attention.output.dense.weight", "camembert.encoder.layer.3.attention.output.dense.bias", "camembert.encoder.layer.3.attention.output.LayerNorm.weight", "camembert.encoder.layer.3.attention.output.LayerNorm.bias", "camembert.encoder.layer.3.intermediate.dense.weight", "camembert.encoder.layer.3.intermediate.dense.bias", "camembert.encoder.layer.3.output.dense.weight", "camembert.encoder.layer.3.output.dense.bias", "camembert.encoder.layer.3.output.LayerNorm.weight", "camembert.encoder.layer.3.output.LayerNorm.bias", "camembert.encoder.layer.4.attention.self.query.weight", "camembert.encoder.layer.4.attention.self.query.bias", "camembert.encoder.layer.4.attention.self.key.weight", "camembert.encoder.layer.4.attention.self.key.bias", "camembert.encoder.layer.4.attention.self.value.weight", "camembert.encoder.layer.4.attention.self.value.bias", "camembert.encoder.layer.4.attention.output.dense.weight", "camembert.encoder.layer.4.attention.output.dense.bias", "camembert.encoder.layer.4.attention.output.LayerNorm.weight", "camembert.encoder.layer.4.attention.output.LayerNorm.bias", "camembert.encoder.layer.4.intermediate.dense.weight", "camembert.encoder.layer.4.intermediate.dense.bias", "camembert.encoder.layer.4.output.dense.weight", "camembert.encoder.layer.4.output.dense.bias", "camembert.encoder.layer.4.output.LayerNorm.weight", "camembert.encoder.layer.4.output.LayerNorm.bias", "camembert.encoder.layer.5.attention.self.query.weight", "camembert.encoder.layer.5.attention.self.query.bias", "camembert.encoder.layer.5.attention.self.key.weight", "camembert.encoder.layer.5.attention.self.key.bias", "camembert.encoder.layer.5.attention.self.value.weight", "camembert.encoder.layer.5.attention.self.value.bias", "camembert.encoder.layer.5.attention.output.dense.weight", "camembert.encoder.layer.5.attention.output.dense.bias", "camembert.encoder.layer.5.attention.output.LayerNorm.weight", "camembert.encoder.layer.5.attention.output.LayerNorm.bias", "camembert.encoder.layer.5.intermediate.dense.weight", "camembert.encoder.layer.5.intermediate.dense.bias", "camembert.encoder.layer.5.output.dense.weight", "camembert.encoder.layer.5.output.dense.bias", "camembert.encoder.layer.5.output.LayerNorm.weight", "camembert.encoder.layer.5.output.LayerNorm.bias", "camembert.encoder.layer.6.attention.self.query.weight", "camembert.encoder.layer.6.attention.self.query.bias", "camembert.encoder.layer.6.attention.self.key.weight", "camembert.encoder.layer.6.attention.self.key.bias", "camembert.encoder.layer.6.attention.self.value.weight", "camembert.encoder.layer.6.attention.self.value.bias", "camembert.encoder.layer.6.attention.output.dense.weight", "camembert.encoder.layer.6.attention.output.dense.bias", "camembert.encoder.layer.6.attention.output.LayerNorm.weight", "camembert.encoder.layer.6.attention.output.LayerNorm.bias", "camembert.encoder.layer.6.intermediate.dense.weight", "camembert.encoder.layer.6.intermediate.dense.bias", "camembert.encoder.layer.6.output.dense.weight", "camembert.encoder.layer.6.output.dense.bias", "camembert.encoder.layer.6.output.LayerNorm.weight", "camembert.encoder.layer.6.output.LayerNorm.bias", "camembert.encoder.layer.7.attention.self.query.weight", "camembert.encoder.layer.7.attention.self.query.bias", "camembert.encoder.layer.7.attention.self.key.weight", "camembert.encoder.layer.7.attention.self.key.bias", "camembert.encoder.layer.7.attention.self.value.weight", "camembert.encoder.layer.7.attention.self.value.bias", "camembert.encoder.layer.7.attention.output.dense.weight", "camembert.encoder.layer.7.attention.output.dense.bias", "camembert.encoder.layer.7.attention.output.LayerNorm.weight", "camembert.encoder.layer.7.attention.output.LayerNorm.bias", "camembert.encoder.layer.7.intermediate.dense.weight", "camembert.encoder.layer.7.intermediate.dense.bias", "camembert.encoder.layer.7.output.dense.weight", "camembert.encoder.layer.7.output.dense.bias", "camembert.encoder.layer.7.output.LayerNorm.weight", "camembert.encoder.layer.7.output.LayerNorm.bias", "camembert.encoder.layer.8.attention.self.query.weight", "camembert.encoder.layer.8.attention.self.query.bias", "camembert.encoder.layer.8.attention.self.key.weight", "camembert.encoder.layer.8.attention.self.key.bias", "camembert.encoder.layer.8.attention.self.value.weight", "camembert.encoder.layer.8.attention.self.value.bias", "camembert.encoder.layer.8.attention.output.dense.weight", "camembert.encoder.layer.8.attention.output.dense.bias", "camembert.encoder.layer.8.attention.output.LayerNorm.weight", "camembert.encoder.layer.8.attention.output.LayerNorm.bias", "camembert.encoder.layer.8.intermediate.dense.weight", "camembert.encoder.layer.8.intermediate.dense.bias", "camembert.encoder.layer.8.output.dense.weight", "camembert.encoder.layer.8.output.dense.bias", "camembert.encoder.layer.8.output.LayerNorm.weight", "camembert.encoder.layer.8.output.LayerNorm.bias", "camembert.encoder.layer.9.attention.self.query.weight", "camembert.encoder.layer.9.attention.self.query.bias", "camembert.encoder.layer.9.attention.self.key.weight", "camembert.encoder.layer.9.attention.self.key.bias", "camembert.encoder.layer.9.attention.self.value.weight", "camembert.encoder.layer.9.attention.self.value.bias", "camembert.encoder.layer.9.attention.output.dense.weight", "camembert.encoder.layer.9.attention.output.dense.bias", "camembert.encoder.layer.9.attention.output.LayerNorm.weight", "camembert.encoder.layer.9.attention.output.LayerNorm.bias", "camembert.encoder.layer.9.intermediate.dense.weight", "camembert.encoder.layer.9.intermediate.dense.bias", "camembert.encoder.layer.9.output.dense.weight", "camembert.encoder.layer.9.output.dense.bias", "camembert.encoder.layer.9.output.LayerNorm.weight", "camembert.encoder.layer.9.output.LayerNorm.bias", "camembert.encoder.layer.10.attention.self.query.weight", "camembert.encoder.layer.10.attention.self.query.bias", "camembert.encoder.layer.10.attention.self.key.weight", "camembert.encoder.layer.10.attention.self.key.bias", "camembert.encoder.layer.10.attention.self.value.weight", "camembert.encoder.layer.10.attention.self.value.bias", "camembert.encoder.layer.10.attention.output.dense.weight", "camembert.encoder.layer.10.attention.output.dense.bias", "camembert.encoder.layer.10.attention.output.LayerNorm.weight", "camembert.encoder.layer.10.attention.output.LayerNorm.bias", "camembert.encoder.layer.10.intermediate.dense.weight", "camembert.encoder.layer.10.intermediate.dense.bias", "camembert.encoder.layer.10.output.dense.weight", "camembert.encoder.layer.10.output.dense.bias", "camembert.encoder.layer.10.output.LayerNorm.weight", "camembert.encoder.layer.10.output.LayerNorm.bias", "camembert.encoder.layer.11.attention.self.query.weight", "camembert.encoder.layer.11.attention.self.query.bias", "camembert.encoder.layer.11.attention.self.key.weight", "camembert.encoder.layer.11.attention.self.key.bias", "camembert.encoder.layer.11.attention.self.value.weight", "camembert.encoder.layer.11.attention.self.value.bias", "camembert.encoder.layer.11.attention.output.dense.weight", "camembert.encoder.layer.11.attention.output.dense.bias", "camembert.encoder.layer.11.attention.output.LayerNorm.weight", "camembert.encoder.layer.11.attention.output.LayerNorm.bias", "camembert.encoder.layer.11.intermediate.dense.weight", "camembert.encoder.layer.11.intermediate.dense.bias", "camembert.encoder.layer.11.output.dense.weight", "camembert.encoder.layer.11.output.dense.bias", "camembert.encoder.layer.11.output.LayerNorm.weight", "camembert.encoder.layer.11.output.LayerNorm.bias","camembert.embeddings.LayerNorm.weight","camembert.embeddings.LayerNorm.bias","lm_head.decoder.weight","lm_head.layer_norm.weight", "lm_head.layer_norm.bias"]

b = ["camembert.embeddings.word_embedding.weight", "camembert.embeddings.position_embedding.weight", "camembert.encoder.layers.0.attention.self.query.weight", "camembert.encoder.layers.0.attention.self.query.bias", "camembert.encoder.layers.0.attention.self.key.weight", "camembert.encoder.layers.0.attention.self.key.bias", "camembert.encoder.layers.0.attention.self.value.weight", "camembert.encoder.layers.0.attention.self.value.bias", "camembert.encoder.layers.0.attention.output.dense.weight", "camembert.encoder.layers.0.attention.output.dense.bias", "camembert.encoder.layers.0.attention.output.LayerNorm.weight", "camembert.encoder.layers.0.attention.output.LayerNorm.bias", "camembert.encoder.layers.0.intermediate.dense.weight", "camembert.encoder.layers.0.intermediate.dense.bias", "camembert.encoder.layers.0.output.dense.weight", 
"camembert.encoder.layers.0.output.dense.bias", "camembert.encoder.layers.0.output.LayerNorm.weight", "camembert.encoder.layers.0.output.LayerNorm.bias", "camembert.encoder.layers.1.attention.self.query.weight", "camembert.encoder.layers.1.attention.self.query.bias", "camembert.encoder.layers.1.attention.self.key.weight", "camembert.encoder.layers.1.attention.self.key.bias", "camembert.encoder.layers.1.attention.self.value.weight", "camembert.encoder.layers.1.attention.self.value.bias", "camembert.encoder.layers.1.attention.output.dense.weight", "camembert.encoder.layers.1.attention.output.dense.bias", "camembert.encoder.layers.1.attention.output.LayerNorm.weight", "camembert.encoder.layers.1.attention.output.LayerNorm.bias", "camembert.encoder.layers.1.intermediate.dense.weight", "camembert.encoder.layers.1.intermediate.dense.bias", "camembert.encoder.layers.1.output.dense.weight", "camembert.encoder.layers.1.output.dense.bias", "camembert.encoder.layers.1.output.LayerNorm.weight", "camembert.encoder.layers.1.output.LayerNorm.bias", "camembert.encoder.layers.2.attention.self.query.weight", "camembert.encoder.layers.2.attention.self.query.bias", "camembert.encoder.layers.2.attention.self.key.weight", "camembert.encoder.layers.2.attention.self.key.bias", "camembert.encoder.layers.2.attention.self.value.weight", "camembert.encoder.layers.2.attention.self.value.bias", "camembert.encoder.layers.2.attention.output.dense.weight", "camembert.encoder.layers.2.attention.output.dense.bias", "camembert.encoder.layers.2.attention.output.LayerNorm.weight", "camembert.encoder.layers.2.attention.output.LayerNorm.bias", "camembert.encoder.layers.2.intermediate.dense.weight", "camembert.encoder.layers.2.intermediate.dense.bias", "camembert.encoder.layers.2.output.dense.weight", "camembert.encoder.layers.2.output.dense.bias", "camembert.encoder.layers.2.output.LayerNorm.weight", "camembert.encoder.layers.2.output.LayerNorm.bias", "camembert.encoder.layers.3.attention.self.query.weight", "camembert.encoder.layers.3.attention.self.query.bias", "camembert.encoder.layers.3.attention.self.key.weight", "camembert.encoder.layers.3.attention.self.key.bias", "camembert.encoder.layers.3.attention.self.value.weight", "camembert.encoder.layers.3.attention.self.value.bias", "camembert.encoder.layers.3.attention.output.dense.weight", "camembert.encoder.layers.3.attention.output.dense.bias", "camembert.encoder.layers.3.attention.output.LayerNorm.weight", "camembert.encoder.layers.3.attention.output.LayerNorm.bias", "camembert.encoder.layers.3.intermediate.dense.weight", "camembert.encoder.layers.3.intermediate.dense.bias", "camembert.encoder.layers.3.output.dense.weight", "camembert.encoder.layers.3.output.dense.bias", "camembert.encoder.layers.3.output.LayerNorm.weight", "camembert.encoder.layers.3.output.LayerNorm.bias", "camembert.encoder.layers.4.attention.self.query.weight", "camembert.encoder.layers.4.attention.self.query.bias", "camembert.encoder.layers.4.attention.self.key.weight", "camembert.encoder.layers.4.attention.self.key.bias", "camembert.encoder.layers.4.attention.self.value.weight", "camembert.encoder.layers.4.attention.self.value.bias", "camembert.encoder.layers.4.attention.output.dense.weight", "camembert.encoder.layers.4.attention.output.dense.bias", "camembert.encoder.layers.4.attention.output.LayerNorm.weight", "camembert.encoder.layers.4.attention.output.LayerNorm.bias", "camembert.encoder.layers.4.intermediate.dense.weight", "camembert.encoder.layers.4.intermediate.dense.bias", "camembert.encoder.layers.4.output.dense.weight", "camembert.encoder.layers.4.output.dense.bias", "camembert.encoder.layers.4.output.LayerNorm.weight", "camembert.encoder.layers.4.output.LayerNorm.bias", "camembert.encoder.layers.5.attention.self.query.weight", "camembert.encoder.layers.5.attention.self.query.bias", "camembert.encoder.layers.5.attention.self.key.weight", "camembert.encoder.layers.5.attention.self.key.bias", "camembert.encoder.layers.5.attention.self.value.weight", "camembert.encoder.layers.5.attention.self.value.bias", "camembert.encoder.layers.5.attention.output.dense.weight", "camembert.encoder.layers.5.attention.output.dense.bias", "camembert.encoder.layers.5.attention.output.LayerNorm.weight", "camembert.encoder.layers.5.attention.output.LayerNorm.bias", "camembert.encoder.layers.5.intermediate.dense.weight", "camembert.encoder.layers.5.intermediate.dense.bias", "camembert.encoder.layers.5.output.dense.weight", "camembert.encoder.layers.5.output.dense.bias", "camembert.encoder.layers.5.output.LayerNorm.weight", "camembert.encoder.layers.5.output.LayerNorm.bias", "camembert.encoder.layers.6.attention.self.query.weight", "camembert.encoder.layers.6.attention.self.query.bias", "camembert.encoder.layers.6.attention.self.key.weight", "camembert.encoder.layers.6.attention.self.key.bias", "camembert.encoder.layers.6.attention.self.value.weight", "camembert.encoder.layers.6.attention.self.value.bias", "camembert.encoder.layers.6.attention.output.dense.weight", "camembert.encoder.layers.6.attention.output.dense.bias", "camembert.encoder.layers.6.attention.output.LayerNorm.weight", "camembert.encoder.layers.6.attention.output.LayerNorm.bias", "camembert.encoder.layers.6.intermediate.dense.weight", "camembert.encoder.layers.6.intermediate.dense.bias", "camembert.encoder.layers.6.output.dense.weight", "camembert.encoder.layers.6.output.dense.bias", "camembert.encoder.layers.6.output.LayerNorm.weight", "camembert.encoder.layers.6.output.LayerNorm.bias", "camembert.encoder.layers.7.attention.self.query.weight", "camembert.encoder.layers.7.attention.self.query.bias", "camembert.encoder.layers.7.attention.self.key.weight", "camembert.encoder.layers.7.attention.self.key.bias", "camembert.encoder.layers.7.attention.self.value.weight", "camembert.encoder.layers.7.attention.self.value.bias", "camembert.encoder.layers.7.attention.output.dense.weight", "camembert.encoder.layers.7.attention.output.dense.bias", "camembert.encoder.layers.7.attention.output.LayerNorm.weight", "camembert.encoder.layers.7.attention.output.LayerNorm.bias", "camembert.encoder.layers.7.intermediate.dense.weight", "camembert.encoder.layers.7.intermediate.dense.bias", "camembert.encoder.layers.7.output.dense.weight", "camembert.encoder.layers.7.output.dense.bias", "camembert.encoder.layers.7.output.LayerNorm.weight", "camembert.encoder.layers.7.output.LayerNorm.bias", "camembert.encoder.layers.8.attention.self.query.weight", "camembert.encoder.layers.8.attention.self.query.bias", "camembert.encoder.layers.8.attention.self.key.weight", "camembert.encoder.layers.8.attention.self.key.bias", "camembert.encoder.layers.8.attention.self.value.weight", "camembert.encoder.layers.8.attention.self.value.bias", "camembert.encoder.layers.8.attention.output.dense.weight", "camembert.encoder.layers.8.attention.output.dense.bias", "camembert.encoder.layers.8.attention.output.LayerNorm.weight", "camembert.encoder.layers.8.attention.output.LayerNorm.bias", "camembert.encoder.layers.8.intermediate.dense.weight", "camembert.encoder.layers.8.intermediate.dense.bias", "camembert.encoder.layers.8.output.dense.weight", "camembert.encoder.layers.8.output.dense.bias", "camembert.encoder.layers.8.output.LayerNorm.weight", "camembert.encoder.layers.8.output.LayerNorm.bias", "camembert.encoder.layers.9.attention.self.query.weight", "camembert.encoder.layers.9.attention.self.query.bias", "camembert.encoder.layers.9.attention.self.key.weight", "camembert.encoder.layers.9.attention.self.key.bias", "camembert.encoder.layers.9.attention.self.value.weight", "camembert.encoder.layers.9.attention.self.value.bias", "camembert.encoder.layers.9.attention.output.dense.weight", "camembert.encoder.layers.9.attention.output.dense.bias", "camembert.encoder.layers.9.attention.output.LayerNorm.weight", "camembert.encoder.layers.9.attention.output.LayerNorm.bias", "camembert.encoder.layers.9.intermediate.dense.weight", "camembert.encoder.layers.9.intermediate.dense.bias", "camembert.encoder.layers.9.output.dense.weight", "camembert.encoder.layers.9.output.dense.bias", "camembert.encoder.layers.9.output.LayerNorm.weight", "camembert.encoder.layers.9.output.LayerNorm.bias", "camembert.encoder.layers.10.attention.self.query.weight", "camembert.encoder.layers.10.attention.self.query.bias", "camembert.encoder.layers.10.attention.self.key.weight", "camembert.encoder.layers.10.attention.self.key.bias", "camembert.encoder.layers.10.attention.self.value.weight", "camembert.encoder.layers.10.attention.self.value.bias", "camembert.encoder.layers.10.attention.output.dense.weight", "camembert.encoder.layers.10.attention.output.dense.bias", "camembert.encoder.layers.10.attention.output.LayerNorm.weight", "camembert.encoder.layers.10.attention.output.LayerNorm.bias", "camembert.encoder.layers.10.intermediate.dense.weight", "camembert.encoder.layers.10.intermediate.dense.bias", "camembert.encoder.layers.10.output.dense.weight", "camembert.encoder.layers.10.output.dense.bias", "camembert.encoder.layers.10.output.LayerNorm.weight", "camembert.encoder.layers.10.output.LayerNorm.bias", "camembert.encoder.layers.11.attention.self.query.weight", "camembert.encoder.layers.11.attention.self.query.bias", "camembert.encoder.layers.11.attention.self.key.weight", "camembert.encoder.layers.11.attention.self.key.bias", "camembert.encoder.layers.11.attention.self.value.weight", "camembert.encoder.layers.11.attention.self.value.bias", "camembert.encoder.layers.11.attention.output.dense.weight", "camembert.encoder.layers.11.attention.output.dense.bias", "camembert.encoder.layers.11.attention.output.LayerNorm.weight", "camembert.encoder.layers.11.attention.output.LayerNorm.bias", "camembert.encoder.layers.11.intermediate.dense.weight", "camembert.encoder.layers.11.intermediate.dense.bias", "camembert.encoder.layers.11.output.dense.weight", "camembert.encoder.layers.11.output.dense.bias", "camembert.encoder.layers.11.output.LayerNorm.weight", "camembert.encoder.layers.11.output.LayerNorm.bias", "camembert.embeddings.LayerNorm.weight","camembert.embeddings.LayerNorm.bias","lm_head.weight","layer_norm.weight", "layer_norm.bias"]


class CamembertForPreTraining(nn.Module):
    def __init__(self, config: CamembertConfig):
        super().__init__()
        self.camembert = CamembertModel(config)
        self.lm_head = nn.Linear(config.hidden_size, config.vocab_size, bias=False)
        self.layer_norm = nn.LayerNorm(config.hidden_size, eps=config.layer_norm_eps)

        self.apply(lambda module: roberta_init_weights(module, config.initializer_range))

    def forward(self, input_ids, attention_mask=None, labels=None):
        sequence_output = self.camembert(input_ids, attention_mask=attention_mask)
        logits = self.lm_head(sequence_output)

        loss = None
        if labels is not None:
            loss_fct = nn.CrossEntropyLoss()
            loss = loss_fct(logits.view(-1, self.camembert.config.vocab_size), labels.view(-1))

        return logits, loss

    @classmethod
    def load_pretrained(cls, path, device='cuda'):
        # On charge un modèle pré-entraîné
        state = torch.load(path, map_location=device)
        int_state = {}
        for key in state.keys():
            first_part, second_part = key.split('.', 1)
            if first_part == "roberta":
                 new_key = "camembert." + second_part
                 int_state[new_key] = state[key]                 
            else:
                 int_state[key] = state[key]
        new_state = {}
        for i,k in enumerate(a):
             new_state[b[i]] = int_state[k]
   

        config = CamembertConfig()
        model = cls(config)
        model.load_state_dict(new_state)
        model.to(device)
        return model